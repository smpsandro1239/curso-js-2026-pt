<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso JavaScript 2026 - Aula 28: Projeto Final</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-card: #2d3748;
            --text-main: #f7fafc;
            --text-sec: #a0aec0;
            --accent: #4fd1c5;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        /* App Container */
        .weather-app {
            background: #1a202c;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            max-width: 800px;
            margin: 40px auto;
            overflow: hidden;
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 500px;
        }

        /* Sidebar (Search & History) */
        .sidebar-app {
            background: #2d3748;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: none;
            background: #4a5568;
            color: white;
            outline: none;
            transition: 0.3s;
        }

        .search-box input:focus {
            background: #718096;
            box-shadow: 0 0 0 2px var(--accent);
        }

        .city-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
        }

        .city-item {
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
            color: var(--text-sec);
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .city-item:hover, .city-item.active {
            background: #4a5568;
            color: white;
        }

        /* Main Display */
        .main-display {
            padding: 40px;
            background-image: linear-gradient(135deg, #1a202c 0%, #2c3e50 100%);
            color: white;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .weather-info h1 {
            font-size: 3rem;
            margin: 0;
            font-weight: 300;
        }

        .weather-info .temp-big {
            font-size: 5rem;
            font-weight: 700;
            letter-spacing: -2px;
            margin: 10px 0;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .detail-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        .detail-label { font-size: 0.8em; color: var(--text-sec); }
        .detail-value { font-size: 1.2em; font-weight: bold; margin-top: 5px; }

        /* Loading State */
        .loading {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: 0.3s;
        }
        .loading.show { opacity: 1; pointer-events: all; }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #fff;
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 700px) {
            .weather-app { grid-template-columns: 1fr; }
            .sidebar-app { padding: 20px; }
            .main-display { padding: 20px; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="course-info">
                    <h1>Curso Completo de JavaScript - 2026</h1>
                    <p>M√≥dulo 7: Projeto Final</p>
                </div>
                <div class="timer">
                    <h3>Projeto</h3>
                    <div class="time-display" id="clock">‚àû</div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">

        <div class="section">
            <h2 style="text-align: center; margin-bottom: 30px;">üå§Ô∏è WeatherDash: A Tua Primeira App Real</h2>

            <div class="weather-app">
                <!-- Loading Overlay -->
                <div class="loading" id="loader">
                    <div class="spinner"></div>
                </div>

                <!-- Sidebar -->
                <div class="sidebar-app">
                    <div class="search-box">
                        <input type="text" id="city-input" placeholder="üîç Procurar cidade..." autocomplete="off">
                    </div>
                    <h4 style="color: var(--text-sec); margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px;">Cidades Populares</h4>
                    <ul class="city-list" id="city-list">
                        <!-- JS vai preencher isto -->
                    </ul>
                </div>

                <!-- Main Display -->
                <div class="main-display" id="main-display">
                    <div class="weather-info">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <h2 id="city-name" style="margin: 0;">Lisboa</h2>
                            <span id="date-now" style="background: var(--accent); color: #1a202c; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold;">HOJE</span>
                        </div>
                        <p id="weather-desc" style="color: var(--text-sec); font-size: 1.2rem;">C√©u Limpo</p>

                        <div class="temp-big">
                            <span id="temp-val">22</span><span style="font-size: 0.5em; color: var(--accent)">¬∞C</span>
                        </div>
                    </div>

                    <div class="weather-details">
                        <div class="detail-card">
                            <div class="detail-label">Vento</div>
                            <div class="detail-value"><span id="wind-val">15</span> km/h</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">Humidade</div>
                            <div class="detail-value"><span id="hum-val">45</span>%</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">Sensa√ß√£o</div>
                            <div class="detail-value"><span id="feels-val">24</span>¬∞C</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="verification">
                <h2>üß† Blueprint do Arquiteto de Software</h2>
                <p style="text-align: center; margin-bottom: 20px;">
                    Um programador s√©nior n√£o escreve c√≥digo aleatoriamente. Ele <strong>planeia</strong>.
                    <br>Vamos construir a l√≥gica mental deste projeto, do zero ao fim. Se conseguires responder a tudo, est√°s pronto para programar qualquer coisa!
                </p>

                <!-- STEP 1: PLANNING -->
                <div class="question" data-question="1">
                    <h3>1. Fase de Planeamento: O que precisamos antes de sequer abrir o VS Code?</h3>
                    <div class="options">
                        <div class="option" data-value="a">Ir ao Google copiar um projeto de meteorologia feito.</div>
                        <div class="option" data-value="b">Identificar as funcionalidades essenciais (Requisitos) e desenhar um esbo√ßo da interface (Wireframe).</div>
                        <div class="option" data-value="c">Come√ßar logo a escrever fun√ß√µes aleat√≥rias.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <!-- STEP 2: HTML STRUCTURE -->
                <div class="question" data-question="2">
                    <h3>2. Estrutura (HTML): Como organizarias o layout desta app?</h3>
                    <div class="options">
                        <div class="option" data-value="a">Tudo dentro de uma √∫nica `div`, misturado.</div>
                        <div class="option" data-value="b">Uma sec√ß√£o para a "Sidebar" (pesquisa) e outra para o "Conte√∫do Principal" (dados do tempo), ambas dentro de um contentor pai.</div>
                        <div class="option" data-value="c">Usar uma tabela HTML gigante para alinhar tudo.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <!-- STEP 3: DOM SELECTION -->
                <div class="question" data-question="3">
                    <h3>3. Sele√ß√£o (JS): O HTML est√° pronto. Qual √© o primeiro passo no JavaScript?</h3>
                    <div class="options">
                        <div class="option" data-value="a">Adicionar anima√ß√µes CSS.</div>
                        <div class="option" data-value="b">Come√ßar a fazer pedidos √† API.</div>
                        <div class="option" data-value="c">Criar vari√°veis que guardam refer√™ncias para os elementos do ecr√£ (Inputs, Bot√µes, Texto de Sa√≠da) usando `document.querySelector`.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <!-- STEP 4: EVENT LISTENERS -->
                <div class="question" data-question="4">
                    <h3>4. Intera√ß√£o: Queremos que algo aconte√ßa quando o utilizador carrega "Enter" no input. O que usamos?</h3>
                    <div class="options">
                        <div class="option" data-value="a">Um loop `while` que verifica a toda a hora se algu√©m escreveu.</div>
                        <div class="option" data-value="b">Um `addEventListener` para escutar o evento 'keypress' ou 'submit'.</div>
                        <div class="option" data-value="c">A propriedade HTML `onclick`.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <!-- STEP 5: ASYNC LOGIC -->
                <div class="question" data-question="5">
                    <h3>5. API: Agora precisamos dos dados da cidade. A chamada √† API √© instant√¢nea?</h3>
                    <div class="options">
                        <div class="option" data-value="a">N√£o. Devemos usar `async/await` para esperar pela resposta sem bloquear o site (promessas).</div>
                        <div class="option" data-value="b">Sim, √© imediato, funciona como uma vari√°vel normal.</div>
                        <div class="option" data-value="c">N√£o sei, uso `setTimeout` de 5 segundos para garantir.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <!-- STEP 6: UX (User Experience) -->
                <div class="question" data-question="6">
                    <h3>6. UX: Enquanto o `await` espera pelos dados, o que deve ver o utilizador?</h3>
                    <div class="options">
                        <div class="option" data-value="a">Um ecr√£ branco.</div>
                        <div class="option" data-value="b">O site congelado e inamov√≠vel.</div>
                        <div class="option" data-value="c">Um indicador visual de "Carregando..." (Loader/Spinner) para dar feedback imediato.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <!-- STEP 7: ERROR HANDLING -->
                <div class="question" data-question="7">
                    <h3>7. Robustez: E se o utilizador escrever "Cidade Imagin√°ria"?</h3>
                    <div class="options">
                        <div class="option" data-value="a">O site deve crashar e mostrar erros na consola.</div>
                        <div class="option" data-value="b">Devemos usar um bloco `try...catch` para apanhar o erro e mostrar um alerta amig√°vel: "Cidade n√£o encontrada".</div>
                        <div class="option" data-value="c">Ignoramos e mostramos dados de Lisboa por defeito.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <!-- STEP 8: ARCHITECTURE -->
                <div class="question" data-question="8">
                    <h3>8. Organiza√ß√£o: O c√≥digo est√° a ficar grande. Como organizamos a l√≥gica da App?</h3>
                    <div class="options">
                        <div class="option" data-value="a">Deixamos tudo numa "tripa" de 500 linhas.</div>
                        <div class="option" data-value="b">Usamos Classes (POO) ou M√≥dulos para agrupar fun√ß√µes relacionadas (ex: uma Classe `WeatherApp` que gere o estado).</div>
                        <div class="option" data-value="c">Escrevemos o JS dentro das tags HTML.</div>
                    </div>
                    <div class="feedback">
                        <div class="explanation"></div>
                        <div class="analogy-feedback"></div>
                    </div>
                </div>

                <button class="submit-btn" id="submitBtn" disabled>Validar Blueprint do Projeto</button>

                <div class="results" id="results">
                    <h3 id="resultsText"></h3>
                    <p id="resultsScore"></p>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>üìù Como funciona este c√≥digo?</h3>
            <p>Us√°mos tudo o que aprendeste at√© agora:</p>
            <ul style="line-height: 1.8;">
                <li><strong>Classes</strong>: <code>WeatherApp</code> gere todo o estado e l√≥gica.</li>
                <li><strong>Async/Await e Fetch</strong>: Para falar com a API da Open-Meteo.</li>
                <li><strong>DOM</strong>: Para atualizar o HTML dinamicamente.</li>
                <li><strong>Eventos</strong>: Para detetar a escrita no input e cliques.</li>
            </ul>
        </div>

        <div class="lesson-navigation">
            <a href="../aula-27-classes/index.html" class="nav-btn prev">
                <span class="arrow">‚Üê</span> Aula Anterior
            </a>
            <a href="../index.html" class="nav-btn home">
                <span class="arrow">üè†</span>
            </a>
            <a href="#" class="nav-btn next" style="opacity: 0.5; cursor: default;">
                Fim do Curso <span class="arrow">üéâ</span>
            </a>
        </div>
    </div>

    <script>
        window.courseData = {
            questions: {
                1: {
                    correct: 'b',
                    explanation: '<strong>1¬∫ Passo: Requisitos.</strong> Antes de tocar em c√≥digo, tens de saber O QUE vais fazer. Desenhar um esbo√ßo e listar funcionalidades poupa horas de reescrita depois.',
                    analogy: 'Um arquiteto faz a planta da casa (blueprint) antes de o empreiteiro colocar o primeiro tijolo.'
                },
                2: {
                    correct: 'b',
                    explanation: '<strong>2¬∫ Passo: Layout.</strong> Pensar em "Blocos". Um bloco para pesquisa, um bloco para mostrar resultados atual. Isso dita a estrutura HTML que vais criar.',
                    analogy: '√â como arrumar uma estante: decides onde ficam os livros (conte√∫do) e onde ficam as decora√ß√µes (sidebar) antes de l√° p√¥r as coisas.'
                },
                3: {
                    correct: 'c',
                    explanation: '<strong>3¬∫ Passo: "Mise en Place".</strong> O JS precisa de saber onde vai mexer. Criamos vari√°veis (const input, const botao) logo no in√≠cio para n√£o termos `document.querySelector` espalhado por todo o lado.',
                    analogy: 'O chefe de cozinha prepara a faca, a t√°bua e os ingredientes na bancada antes de come√ßar a picar.'
                },
                4: {
                    correct: 'b',
                    explanation: '<strong>4¬∫ Passo: Ouvir o Utilizador.</strong> O computador √© passivo. Ele precisa de um "Trigger" (Gatilho) para agir. O `addEventListener` √© esse gatilho que liga a a√ß√£o do humano √† l√≥gica da m√°quina.',
                    analogy: '√â como colocar uma campainha na porta. Se n√£o houver campainha, ningu√©m sabe que chegaste.'
                },
                5: {
                    correct: 'a',
                    explanation: '<strong>5¬∫ Passo: Assincronismo.</strong> Pedir dados a um servidor na Alemanha demora tempo (ms). O JavaScript n√£o pode parar. `async/await` permite pausar apenas aquela fun√ß√£o sem congelar o site.',
                    analogy: 'Enquanto a pizza est√° no forno (await), tu podes p√¥r a mesa ou ver TV. N√£o ficas especado a olhar para o forno.'
                },
                6: {
                    correct: 'c',
                    explanation: '<strong>6¬∫ Passo: Feedback Visual.</strong> O utilizador √© impaciente. Se clica e nada acontece por 1 segundo, ele acha que estragou o site. Um Spinner diz: "Calma, estou a trabalhar".',
                    analogy: '√â como o som de chamada quando telefonas a algu√©m. Se fosse sil√™ncio absoluto, achavas que a chamada tinha ca√≠do.'
                },
                7: {
                    correct: 'b',
                    explanation: '<strong>7¬∫ Passo: Tratamento de Erros.</strong> O mundo real √© imperfeito. A internet falha, as cidades n√£o existem. `try...catch` impede que o site "morra" e permite mostrar uma mensagem educada.',
                    analogy: 'O airbag do carro. Esperamos n√£o o usar, mas se batermos (erro), ele salva-nos de consequ√™ncias piores.'
                },
                8: {
                    correct: 'b',
                    explanation: '<strong>8¬∫ Passo: Refatoriza√ß√£o.</strong> C√≥digo limpo √© c√≥digo que se l√™ como um livro. Agrupar l√≥gicas em Classes ou Fun√ß√µes torna o projeto f√°cil de manter no futuro.',
                    analogy: '√â a diferen√ßa entre ter a roupa toda atirada para uma cadeira (c√≥digo desorganizado) ou dobrada em gavetas etiquetadas (Classes).'
                }
            }
        };
    </script>

    <script>
        // --- 1. CONFIGURA√á√ÉO E DADOS ---
        const DEFAULT_CITIES = [
            { name: "Lisboa", lat: 38.71, lon: -9.13 },
            { name: "Porto", lat: 41.15, lon: -8.62 },
            { name: "Faro", lat: 37.01, lon: -7.93 },
            { name: "Funchal", lat: 32.65, lon: -16.90 },
            { name: "Ponta Delgada", lat: 37.74, lon: -25.67 },
            { name: "Madrid", lat: 40.41, lon: -3.70 },
            { name: "Paris", lat: 48.85, lon: 2.35 },
            { name: "Londres", lat: 51.50, lon: -0.12 },
        ];

        // --- 2. CLASSE PRINCIPAL ---
        class WeatherApp {
            constructor() {
                // Seletores DOM
                this.dom = {
                    input: document.getElementById('city-input'),
                    list: document.getElementById('city-list'),
                    loader: document.getElementById('loader'),
                    // UI Display
                    city: document.getElementById('city-name'),
                    desc: document.getElementById('weather-desc'),
                    temp: document.getElementById('temp-val'),
                    wind: document.getElementById('wind-val'),
                    hum: document.getElementById('hum-val'),
                    feels: document.getElementById('feels-val'),
                };

                // Estado Inicial
                this.init();
            }

            init() {
                // Renderizar lista inicial
                this.renderCityList(DEFAULT_CITIES);

                // Carregar primeira cidade
                this.loadWeather(DEFAULT_CITIES[0]);

                // Event Listeners
                this.dom.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.searchCity(this.dom.input.value);
                });
            }

            // --- L√ìGICA DE API (ASYNC/AWAIT) ---

            async searchCity(query) {
                if (!query) return;
                this.toggleLoading(true);

                try {
                    // Geocoding API (Open-Meteo)
                    const url = `https://geocoding-api.open-meteo.com/v1/search?name=${query}&count=1&language=pt&format=json`;
                    const res = await fetch(url);
                    const data = await res.json();

                    if (!data.results || data.results.length === 0) {
                        throw new Error("Cidade n√£o encontrada.");
                    }

                    const city = {
                        name: data.results[0].name,
                        lat: data.results[0].latitude,
                        lon: data.results[0].longitude
                    };

                    await this.loadWeather(city);
                    this.dom.input.value = ""; // Limpar input

                } catch (error) {
                    alert("‚ùå Erro: " + error.message);
                } finally {
                    this.toggleLoading(false);
                }
            }

            async loadWeather(city) {
                this.toggleLoading(true);

                try {
                    // Weather API (Open-Meteo)
                    // Pede: temperatura, vento, humidade e weathercode
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m`;

                    const res = await fetch(url);
                    const data = await res.json();

                    this.updateUI(city, data.current);

                } catch (error) {
                    console.error(error);
                    alert("Falha ao obter meteorologia.");
                } finally {
                    this.toggleLoading(false);
                }
            }

            // --- L√ìGICA DE UI (DOM) ---

            updateUI(city, current) {
                this.dom.city.textContent = city.name;
                this.dom.temp.textContent = Math.round(current.temperature_2m);
                this.dom.wind.textContent = current.wind_speed_10m;
                this.dom.hum.textContent = current.relative_humidity_2m;
                this.dom.feels.textContent = Math.round(current.apparent_temperature);

                this.dom.desc.textContent = this.getWeatherString(current.weather_code);
            }

            renderCityList(cities) {
                this.dom.list.innerHTML = "";
                cities.forEach(city => {
                    const li = document.createElement('li');
                    li.className = 'city-item';
                    li.innerHTML = `<span>${city.name}</span> <small>‚û°Ô∏è</small>`;
                    li.addEventListener('click', () => this.loadWeather(city));
                    this.dom.list.appendChild(li);
                });
            }

            toggleLoading(show) {
                if (show) this.dom.loader.classList.add('show');
                else this.dom.loader.classList.remove('show');
            }

            // Helper para traduzir c√≥digos WMO da API
            getWeatherString(code) {
                const codes = {
                    0: "C√©u Limpo ‚òÄÔ∏è",
                    1: "Pouco Nublado üå§Ô∏è",
                    2: "Nublado ‚òÅÔ∏è",
                    3: "Encoberto ‚òÅÔ∏è",
                    45: "Nevoeiro üå´Ô∏è",
                    51: "Chuvisco üåßÔ∏è",
                    61: "Chuva Fraca üåßÔ∏è",
                    63: "Chuva Moderada üåßÔ∏è",
                    65: "Chuva Forte ‚õàÔ∏è",
                    80: "Aguaceiros üå¶Ô∏è",
                    95: "Trovoada ‚ö°"
                };
                return codes[code] || "Desconhecido";
            }
        }

        // Iniciar App
        const app = new WeatherApp();
    </script>
</body>
</html>
